---
const { lang = "en" } = Astro.props;

const content = {
    en: {
        title: "Request Your Free SEO Audit",
        subtitle:
            "Get a detailed analysis of your website's search performance and clear steps to improve it.",
        website: "Website URL",
        email: "Email Address",
        next: "Next Step",
        back: "Go Back",
        send: "Request Free Audit",
        sending: "Processing...",
        successTitle: "Audit Request Received!",
        successMessage:
            "Our team will perform a detailed manual audit of your website and send you the results via email within max. 2 business days.",
        error: "Something went wrong. Please try again.",
        privacyPath: "/privacy",
        privacy: "Privacy Policy",
        consent:
            "I agree to the processing of my personal data according to the",
        benefits: [
            {
                icon: "üìä",
                title: "Comprehensive Analysis",
                desc: "We analyze your keywords, backlinks, and technical SEO factors to see where you stand.",
            },
            {
                icon: "üöÄ",
                title: "Growth Opportunities",
                desc: "Identify easy wins and long-term strategies to outrank your competitors.",
            },
            {
                icon: "üí°",
                title: "Actionable Insights",
                desc: "No fluff - just clear, prioritized recommendations you can implement immediately.",
            },
            {
                icon: "ü§ù",
                title: "Expert Review",
                desc: "Your audit is performed by SEO professionals, not just an automated tool.",
            },
        ],
    },
    hu: {
        title: "K√©rje ingyenes SEO auditj√°t",
        subtitle:
            "R√©szletes elemz√©st kap weboldala keres√©si teljes√≠tm√©ny√©r≈ël √©s egy√©rtelm≈± l√©p√©seket a jav√≠t√°shoz.",
        website: "Weboldal c√≠me",
        email: "Email c√≠m",
        next: "K√∂vetkez≈ë l√©p√©s",
        back: "Vissza",
        send: "Ingyenes Audit K√©r√©se",
        sending: "Folyamatban...",
        successTitle: "Audit k√©r√©s elk√ºldve!",
        successMessage:
            "Csapatunk r√©szletes manu√°lis auditot v√©gez, √©s az eredm√©nyeket 2 munkanapon bel√ºl e-mailben k√ºldj√ºk el.",
        error: "Hiba t√∂rt√©nt. K√©rj√ºk, pr√≥b√°lja √∫jra.",
        privacyPath: "/hu/privacy",
        privacy: "adatkezel√©si t√°j√©koztat√≥ban",
        consent: "Hozz√°j√°rulok a szem√©lyes adataim kezel√©s√©hez az",
        benefits: [
            {
                icon: "üìä",
                title: "√Åtfog√≥ Elemz√©s",
                desc: "Elemezz√ºk kulcsszavait, visszamutat√≥ linkjeit √©s technikai SEO t√©nyez≈ëit.",
            },
            {
                icon: "üöÄ",
                title: "N√∂veked√©si Lehet≈ës√©gek",
                desc: "Azonos√≠tjuk a gyors sikereket √©s a hossz√∫ t√°v√∫ strat√©gi√°kat a versenyt√°rsak megel≈ëz√©s√©hez.",
            },
            {
                icon: "üí°",
                title: "Gyakorlati Tan√°csok",
                desc: "Semmi mell√©besz√©l√©s - csak vil√°gos, rangsorolt aj√°nl√°sok, amelyeket azonnal megval√≥s√≠that.",
            },
            {
                icon: "ü§ù",
                title: "Szak√©rt≈ëi V√©lem√©ny",
                desc: "Az auditot SEO szakemberek v√©gzik, nem csak egy automatiz√°lt eszk√∂z.",
            },
        ],
    },
    ro: {
        title: "SolicitƒÉ Auditul SEO Gratuit",
        subtitle:
            "Prime»ôti o analizƒÉ detaliatƒÉ a performan»õei site-ului tƒÉu √Æn cƒÉutƒÉri »ôi pa»ôi clari pentru √ÆmbunƒÉtƒÉ»õire.",
        website: "URL Website",
        email: "AdresƒÉ de Email",
        next: "Pasul UrmƒÉtor",
        back: "Pasul Anterior",
        send: "SolicitƒÉ Audit Gratuit",
        sending: "Se proceseazƒÉ...",
        successTitle: "Solicitare TrimisƒÉ cu Succes!",
        successMessage:
            "Echipa noastrƒÉ va efectua un audit manual detaliat »ôi vƒÉ va trimite rezultatele prin e-mail √Æn termen de 2 zile lucrƒÉtoare.",
        error: "A apƒÉrut o eroare. VƒÉ rugƒÉm sƒÉ √Æncerca»õi din nou.",
        privacyPath: "/ro/privacy",
        privacy: "politica de confiden»õialitate",
        consent: "Sunt de acord cu prelucrarea datelor mele personale conform",
        benefits: [
            {
                icon: "üìä",
                title: "AnalizƒÉ CompletƒÉ",
                desc: "AnalizƒÉm cuvintele cheie, backlink-urile »ôi factorii tehnici SEO pentru a vedea unde vƒÉ afla»õi.",
            },
            {
                icon: "üöÄ",
                title: "OportunitƒÉ»õi de Cre»ôtere",
                desc: "IdentificƒÉm reu»ôite rapide »ôi strategii pe termen lung pentru a depƒÉ»ôi concuren»õa.",
            },
            {
                icon: "üí°",
                title: "Sfaturi Practice",
                desc: "FƒÉrƒÉ informa»õii inutile - doar recomandƒÉri clare »ôi prioritizate pe care le pute»õi implementa imediat.",
            },
            {
                icon: "ü§ù",
                title: "Revizuire de cƒÉtre Exper»õi",
                desc: "Auditul dvs. este realizat de profesioni»ôti SEO, nu doar de un instrument automatizat.",
            },
        ],
    },
};

const t = content[lang as keyof typeof content] || content.en;
---

<section id="seo-audit" class="py-24 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
            <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                {t.title}
            </h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">{t.subtitle}</p>
        </div>

        <div class="grid lg:grid-cols-5 gap-12 items-start">
            <!-- SEO Audit Form -->
            <div class="lg:col-span-3">
                <div
                    class="bg-white p-8 rounded-2xl shadow-sm border border-gray-100 min-h-[400px] flex flex-col justify-center"
                >
                    <form id="audit-wizard-form" class="space-y-6">
                        <!-- Step 1: Website -->
                        <div id="step-1" class="wizard-step">
                            <div class="mb-8">
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >{t.website}</label
                                >
                                <input
                                    type="text"
                                    name="website"
                                    id="wizard-website"
                                    placeholder="your-website.com"
                                    class="w-full px-4 py-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-shadow text-lg"
                                    required
                                />
                            </div>
                            <button
                                type="button"
                                id="next-to-step-2"
                                class="w-full bg-primary text-white py-4 rounded-xl hover:bg-primary-hover cursor-pointer font-semibold shadow-lg shadow-primary/20 transition-all hover:-translate-y-1 active:scale-95"
                            >
                                {t.next}
                            </button>
                        </div>

                        <!-- Step 2: Email & Consent -->
                        <div id="step-2" class="wizard-step hidden">
                            <div class="mb-6">
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >{t.email}</label
                                >
                                <input
                                    type="email"
                                    name="email"
                                    id="wizard-email"
                                    placeholder="your@email.com"
                                    class="w-full px-4 py-4 border border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-shadow text-lg"
                                    required
                                />
                            </div>

                            <div class="mb-8 flex items-start gap-3">
                                <input
                                    type="checkbox"
                                    id="gdpr-consent-wizard"
                                    name="consent"
                                    value="true"
                                    required
                                    class="mt-1 w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary cursor-pointer"
                                />
                                <label
                                    for="gdpr-consent-wizard"
                                    class="text-sm text-gray-600 leading-tight"
                                >
                                    {t.consent}
                                    <a
                                        href={t.privacyPath}
                                        class="text-primary hover:underline font-medium"
                                        >{t.privacy}</a
                                    >.
                                </label>
                            </div>

                            <div class="flex gap-4">
                                <button
                                    type="button"
                                    id="back-to-step-1"
                                    class="flex-1 bg-gray-50 text-gray-600 py-4 rounded-xl hover:bg-gray-100 cursor-pointer font-semibold transition-all"
                                >
                                    {t.back}
                                </button>
                                <button
                                    type="submit"
                                    id="submit-wizard"
                                    class="flex-[2] bg-primary text-white py-4 rounded-xl hover:bg-primary-hover cursor-pointer font-semibold shadow-lg shadow-primary/20 transition-all hover:-translate-y-1 active:scale-95 disabled:opacity-50"
                                >
                                    <span id="submit-wizard-text">{t.send}</span
                                    >
                                </button>
                            </div>
                        </div>

                        <!-- Success Step -->
                        <div
                            id="step-success"
                            class="wizard-step hidden text-center py-8"
                        >
                            <div
                                class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl"
                            >
                                <i class="ri-checkbox-circle-line"></i>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-900 mb-4">
                                {t.successTitle}
                            </h3>
                            <p class="text-gray-600 text-lg leading-relaxed">
                                {t.successMessage}
                            </p>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sidebar Benefits -->
            <div class="lg:col-span-2 space-y-8">
                {
                    t.benefits.map((benefit) => (
                        <div class="flex gap-4">
                            <div class="flex-shrink-0 w-12 h-12 bg-white rounded-xl shadow-sm border border-gray-100 flex items-center justify-center text-2xl">
                                {benefit.icon}
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900 mb-1">
                                    {benefit.title}
                                </h3>
                                <p class="text-gray-600 leading-relaxed text-sm">
                                    {benefit.desc}
                                </p>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
</section>

<script>
    const form = document.getElementById(
        "audit-wizard-form",
    ) as HTMLFormElement;
    const step1 = document.getElementById("step-1");
    const step2 = document.getElementById("step-2");
    const stepSuccess = document.getElementById("step-success");

    const nextBtn = document.getElementById("next-to-step-2");
    const backBtn = document.getElementById("back-to-step-1");
    const submitBtn = document.getElementById(
        "submit-wizard",
    ) as HTMLButtonElement;
    const submitText = document.getElementById("submit-wizard-text");

    const websiteInput = document.getElementById(
        "wizard-website",
    ) as HTMLInputElement;
    const emailInput = document.getElementById(
        "wizard-email",
    ) as HTMLInputElement;

    if (nextBtn && step1 && step2) {
        nextBtn.addEventListener("click", () => {
            const urlValue = websiteInput.value.trim();
            // Permissive check: must have at least one dot
            if (urlValue && urlValue.includes(".")) {
                step1.classList.add("hidden");
                step2.classList.remove("hidden");
            } else {
                websiteInput.setCustomValidity(
                    document.documentElement.lang === "hu"
                        ? "K√©rj√ºk, adjon meg egy √©rv√©nyes weboldal c√≠met!"
                        : document.documentElement.lang === "ro"
                          ? "VƒÉ rugƒÉm sƒÉ introduce»õi o adresƒÉ de website validƒÉ!"
                          : "Please enter a valid website address!",
                );
                websiteInput.reportValidity();
                websiteInput.setCustomValidity(""); // Clear for future checks
            }
        });
    }

    if (backBtn && step1 && step2) {
        backBtn.addEventListener("click", () => {
            step2.classList.add("hidden");
            step1.classList.remove("hidden");
        });
    }

    if (form && submitBtn && submitText && step2 && stepSuccess) {
        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            submitBtn.disabled = true;
            const originalText = submitText.textContent;
            submitText.textContent =
                document.documentElement.lang === "hu"
                    ? "Folyamatban..."
                    : document.documentElement.lang === "ro"
                      ? "Se proceseazƒÉ..."
                      : "Processing...";

            try {
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                const response = await fetch(
                    "https://submit-form.com/41PA1XYWP",
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Accept: "application/json",
                        },
                        body: JSON.stringify({
                            ...data,
                            _subject: `WIZARD: New SEO Audit Request - ${data.website}`,
                            source: "SEO Audit Wizard",
                        }),
                    },
                );

                if (response.ok) {
                    step2.classList.add("hidden");
                    stepSuccess.classList.remove("hidden");
                } else {
                    throw new Error("Submission failed");
                }
            } catch (error) {
                alert(
                    document.documentElement.lang === "hu"
                        ? "Hiba t√∂rt√©nt. K√©rj√ºk, pr√≥b√°lja √∫jra."
                        : document.documentElement.lang === "ro"
                          ? "A apƒÉrut o eroare. VƒÉ rugƒÉm sƒÉ √Æncerca»õi din nou."
                          : "Something went wrong. Please try again.",
                );
                console.error("Form submission error:", error);
            } finally {
                submitBtn.disabled = false;
                submitText.textContent = originalText;
            }
        });
    }
</script>
