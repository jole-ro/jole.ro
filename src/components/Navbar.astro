---
const lang = Astro.props.lang || "en";

const languageRoutes: Record<string, Record<string, string>> = {
  en: {
    home: "/",
    audit: "/seo-audit",
    contact: "/contact",
    privacy: "/privacy",
  },
  hu: {
    home: "/hu/",
    audit: "/hu/ingyenes-seo-audit",
    contact: "/hu/contact",
    privacy: "/hu/privacy",
  },
  ro: {
    home: "/ro/",
    audit: "/ro/audit-seo-gratuit",
    contact: "/ro/contact",
    privacy: "/ro/privacy",
  },
};

const pathname = Astro.url.pathname;

const getPageKey = (path: string) => {
  const normalizedPath = path.endsWith("/") ? path : `${path}/`;
  for (const [l, routes] of Object.entries(languageRoutes)) {
    for (const [key, route] of Object.entries(routes)) {
      const normalizedRoute = route.endsWith("/") ? route : `${route}/`;
      if (normalizedPath === normalizedRoute) {
        return key;
      }
    }
  }
  return null;
};

const pageKey = getPageKey(pathname);

const getLangLink = (targetLang: string) => {
  if (pageKey && languageRoutes[targetLang][pageKey]) {
    return languageRoutes[targetLang][pageKey];
  }
  return languageRoutes[targetLang].home;
};

const navItems: Record<string, { name: string; href: string }[]> = {
  en: [
    { name: "Services", href: "/#services" },
    { name: "Benefits", href: "/#benefits" },
    { name: "Testimonials", href: "/#testimonials" },
    { name: "Free Website Audit", href: "/seo-audit" },
    { name: "Contact", href: "/contact" },
  ],
  hu: [
    { name: "Szolgáltatások", href: "/hu/#services" },
    { name: "Előnyök", href: "/hu/#benefits" },
    { name: "Vélemények", href: "/hu/#testimonials" },
    { name: "Ingyenes Weboldal Audit", href: "/hu/ingyenes-seo-audit" },
    { name: "Kapcsolat", href: "/hu/contact" },
  ],
  ro: [
    { name: "Servicii", href: "/ro/#services" },
    { name: "Beneficii", href: "/ro/#benefits" },
    { name: "Testimoniale", href: "/ro/#testimonials" },
    { name: "Audit Website Gratuit", href: "/ro/audit-seo-gratuit" },
    { name: "Contact", href: "/ro/contact" },
  ],
};

const items = navItems[lang as keyof typeof navItems] || navItems.en;
const langLabel = lang.toUpperCase();
---

<nav
  class="fixed top-0 left-0 right-0 bg-[#f5f3ff] z-50 border-b border-purple-100 shadow-sm transition-all duration-300"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      <div class="flex items-center">
        <a href={lang === "en" ? "/" : `/${lang}/`} class="flex items-center">
          <img src="/images/logo.svg" alt="Jolero Logo" class="h-10 w-auto" />
        </a>
      </div>
      <div class="hidden md:flex items-center space-x-8">
        {
          items.map((item) => (
            <a
              href={item.href}
              class="text-primary hover:text-primary-hover transition-colors font-medium"
            >
              {item.name}
            </a>
          ))
        }

        <!-- Language Selector -->
        <div class="relative group">
          <button
            class="flex items-center text-primary hover:text-primary-hover transition-colors font-medium"
          >
            <span class="mr-1">{langLabel}</span>
            <i class="ri-arrow-down-s-line"></i>
          </button>
          <div class="absolute right-0 mt-0 pt-2 w-32 hidden group-hover:block">
            <div
              class="bg-white rounded-lg shadow-xl border border-gray-100 py-2"
            >
              <a
                href={getLangLink("en")}
                class="block px-4 py-2 text-gray-700 hover:bg-gray-50"
                >English</a
              >
              <a
                href={getLangLink("hu")}
                class="block px-4 py-2 text-gray-700 hover:bg-gray-50">Magyar</a
              >
              <a
                href={getLangLink("ro")}
                class="block px-4 py-2 text-gray-700 hover:bg-gray-50">Română</a
              >
            </div>
          </div>
        </div>

        <a
          href={lang === "en" ? "/contact" : `/${lang}/contact`}
          class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary-hover cursor-pointer whitespace-nowrap transition-colors font-semibold"
        >
          {lang === "en" ? "Get Started" : lang === "hu" ? "Kezdés" : "Începe"}
        </a>
      </div>
    </div>
  </div>
</nav>
